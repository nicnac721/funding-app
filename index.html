<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VC Funding Scenario Simulator</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
    <style>
        /* Basic body styling */
        /* Style Guide Font: Ideally 'New Science', using sans-serif fallback */
        body {
            font-family: sans-serif; /* Fallback for New Science */
            background-color: #f8fafc; /* Tailwind gray-50 */
            color: #1f2937; /* Default text color - gray-800 */
        }
        /* Add some subtle animation for loading */
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
        .spinner {
          display: inline-block;
          width: 1rem;
          height: 1rem;
          vertical-align: text-bottom;
          border: 0.15em solid currentColor;
          border-right-color: transparent;
          border-radius: 50%;
          animation: spin .75s linear infinite;
          margin-left: 0.5rem;
        }
        /* Custom smaller text size */
        .text-xxs {
            font-size: 0.65rem; /* Adjust as needed */
            line-height: 0.9rem;
        }
        /* Ensure SVG text is selectable */
        svg text {
            user-select: text;
            fill: currentColor; /* Inherit text color */
        }
        /* Base styles for chart axes */
        .chart-axis {
            stroke: #d1d5db; /* gray-300 */
            stroke-width: 1;
        }
        /* Base styles for chart text */
        .chart-text {
            font-size: 0.75rem; /* text-xs */
            fill: #4b5563; /* gray-600 */
        }
        .chart-label {
             font-size: 0.75rem; /* text-xs */
             fill: #374151; /* gray-700 */
             font-weight: 500;
        }
        /* Terrain Colors as CSS Variables (Optional, for easier reuse if needed) */
        :root {
            --terrain-navy: #141E46;
            --terrain-mint: #8DECB4;
            --terrain-green: #41B06E;
            --terrain-cream: #FFF5E0;
            --terrain-creamsicle: #FFA770;
            --terrain-brown: #402A1C;
            --terrain-dark-brown: #20150E;
            --terrain-error: #F4291B;
            --terrain-success: #74C911;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- React and Hook Imports (available globally via CDN) ---
        const { useState, useCallback, useMemo, Fragment } = React;

        // --- Simulation Logic (Ported from Python to JS) ---
        // [Simulation logic functions: SCENARIO_PARAMS, calculateSafeConversion, simulateScenario - remain the same]
        // Constants and Fixed Assumptions
        const INITIAL_TOTAL_SHARES = 10_000_000;
        const FOUNDER_SHARES = 9_000_000;
        const INITIAL_ESOP_SHARES = 1_000_000;
        const ESOP_TARGET_PCT = 0.15;
        const SCENARIO_PARAMS = {
            "Conservative": { rounds: [], exit_valuation: 30_000_000, exit_type: "Acquisition" },
            "Baseline": { rounds: [{"name": "Series A", "investment": 8_000_000, "pre_money": 25_000_000}, {"name": "Series B", "investment": 20_000_000, "pre_money": 70_000_000}, {"name": "Series C", "investment": 40_000_000, "pre_money": 160_000_000}], exit_valuation: 300_000_000, exit_type: "Acquisition" },
            "Bullish": { rounds: [{"name": "Series A", "investment": 10_000_000, "pre_money": 35_000_000}, {"name": "Series B", "investment": 30_000_000, "pre_money": 120_000_000}, {"name": "Series C", "investment": 60_000_000, "pre_money": 300_000_000}], exit_valuation: {"IPO": 700_000_000, "Acquisition": 2_000_000_000}, exit_type: "IPO_and_Acquisition" }
        };
        function calculateSafeConversion(safe_details, trigger_pps, fd_shares_pre_conversion, trigger_cap_valuation = null) {
            const { investment, cap, discount: discountPercent } = safe_details;
            const numericInvestment = Number(investment);
            if (isNaN(numericInvestment) || numericInvestment <= 0) { return 0; }
            const discount = discountPercent / 100.0;
            const safe_trigger_pps = Math.max(trigger_pps, 0.000001);
            const discount_price = safe_trigger_pps * (1.0 - discount);
            let cap_price = Infinity;
            if (cap && fd_shares_pre_conversion > 0) { cap_price = cap / fd_shares_pre_conversion; }
            let conversion_price = discount_price;
            if (cap) { conversion_price = Math.min(discount_price, cap_price); }
            if (conversion_price <= 0) { return 0; }
            const shares_issued = numericInvestment / conversion_price;
            return shares_issued;
        }
        function simulateScenario(scenario_name, initial_shares_dict, safe_terms) {
            let shares = { ...initial_shares_dict }; const params = SCENARIO_PARAMS[scenario_name]; const safes_invested = { ...safe_terms };
            let roundInvestments = {};
            roundInvestments['Pre-Seed'] = safes_invested['Pre-Seed']?.investment || 0;
            roundInvestments['Seed'] = safes_invested['Seed']?.investment || 0;
            if (scenario_name === "Conservative") {
                const exit_valuation = params.exit_valuation; let fd_pre_conversion = Object.values(shares).reduce((sum, count) => sum + count, 0);
                const est_trigger_pps = fd_pre_conversion > 0 ? exit_valuation / fd_pre_conversion : 0.000001;
                let total_shares_after_conversion = fd_pre_conversion; const converted_safe_shares = {};
                const ps_shares = calculateSafeConversion(safes_invested['Pre-Seed'], est_trigger_pps, fd_pre_conversion, exit_valuation);
                converted_safe_shares['Pre-Seed'] = ps_shares; total_shares_after_conversion += ps_shares;
                const fd_shares_for_seed_cap_calc = fd_pre_conversion + ps_shares;
                const s_shares = calculateSafeConversion(safes_invested['Seed'], est_trigger_pps, fd_shares_for_seed_cap_calc, exit_valuation);
                converted_safe_shares['Seed'] = s_shares; total_shares_after_conversion += s_shares;
                shares['Pre-Seed'] = converted_safe_shares['Pre-Seed'] || 0; shares['Seed'] = converted_safe_shares['Seed'] || 0;
                const total_final_shares = total_shares_after_conversion; const value_per_share = total_final_shares > 0 ? exit_valuation / total_final_shares : 0;
                return { Scenario: scenario_name, ExitValuation: exit_valuation, TotalShares: total_final_shares, ValuePerShare: value_per_share, FinalShares: shares, ExitType: params.exit_type, Rounds: params.rounds, RoundInvestments: roundInvestments };
            }
            let safes_to_convert_in_A = Object.keys(safes_invested).filter(k => k === 'Pre-Seed' || k === 'Seed');
            params.rounds.forEach(round_info => {
                const { name: round_name, investment, pre_money } = round_info;
                roundInvestments[round_name] = investment;
                const fd_pre_round = Object.values(shares).reduce((sum, count) => sum + count, 0); const current_esop = shares['ESOP'] || 0;
                const denominator = 1.0 - ESOP_TARGET_PCT; const target_total_esop_shares = denominator !== 0 ? (fd_pre_round / denominator) * ESOP_TARGET_PCT : fd_pre_round * 1.15 * 0.15;
                const new_esop_shares = Math.max(0, target_total_esop_shares - current_esop); shares['ESOP'] = current_esop + new_esop_shares; const fd_post_esop = fd_pre_round + new_esop_shares;
                let total_safe_shares_added = 0;
                if (round_name === "Series A" && safes_to_convert_in_A.length > 0) {
                    const trigger_pps = fd_post_esop > 0 ? pre_money / fd_post_esop : 0.000001; let current_fd_for_cap_calc = fd_post_esop; const safes_converted_this_round = {};
                    safes_to_convert_in_A.forEach(safe_name => { const safe_details = safes_invested[safe_name]; const shares_issued = calculateSafeConversion(safe_details, trigger_pps, current_fd_for_cap_calc); safes_converted_this_round[safe_name] = shares_issued; total_safe_shares_added += shares_issued; current_fd_for_cap_calc += shares_issued; });
                    Object.entries(safes_converted_this_round).forEach(([name, count]) => { shares[name] = (shares[name] || 0) + count; }); safes_to_convert_in_A = [];
                }
                const fd_post_safes = fd_post_esop + total_safe_shares_added; const pps = fd_post_safes > 0 ? pre_money / fd_post_safes : 0.000001; const new_investor_shares = pps > 0 ? investment / pps : 0; shares[round_name] = new_investor_shares;
            });
            const final_shares_post_rounds = shares; const total_shares_at_exit = Object.values(final_shares_post_rounds).reduce((sum, count) => sum + count, 0);
            const results = { Scenario: scenario_name, TotalShares: total_shares_at_exit, FinalShares: final_shares_post_rounds, ExitType: params.exit_type, Rounds: params.rounds, RoundInvestments: roundInvestments };
            if (params.exit_type === "IPO_and_Acquisition") { const ipo_val = params.exit_valuation.IPO; const acq_val = params.exit_valuation.Acquisition; results.ExitValuation_IPO = ipo_val; results.ValuePerShare_IPO = total_shares_at_exit > 0 ? ipo_val / total_shares_at_exit : 0; results.ExitValuation_Acq = acq_val; results.ValuePerShare_Acq = total_shares_at_exit > 0 ? acq_val / total_shares_at_exit : 0; }
            else { const exit_val = params.exit_valuation; results.ExitValuation = exit_val; results.ValuePerShare = total_shares_at_exit > 0 ? exit_val / total_shares_at_exit : 0; }
            return results;
        }

        // --- Formatting Helpers ---
        // [Formatting helper functions: formatNumber, formatCurrency, etc. - remain the same]
        const formatNumber = (num, options = {}) => (num || 0).toLocaleString(undefined, { maximumFractionDigits: 0, ...options });
        const formatCurrency = (num) => { if (!num || !isFinite(num)) return '$0'; if (Math.abs(num) >= 1e9) return (num / 1e9).toLocaleString(undefined, { style: 'currency', currency: 'USD', minimumFractionDigits: 1, maximumFractionDigits: 2 }) + 'B'; if (Math.abs(num) >= 1e6) return (num / 1e6).toLocaleString(undefined, { style: 'currency', currency: 'USD', minimumFractionDigits: 1, maximumFractionDigits: 2 }) + 'M'; if (Math.abs(num) >= 1e3) return (num / 1e3).toLocaleString(undefined, { style: 'currency', currency: 'USD', minimumFractionDigits: 1, maximumFractionDigits: 2 }) + 'k'; return (num || 0).toLocaleString(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }); };
        const formatCurrencyNoAbbrev = (num) => (num || 0).toLocaleString(undefined, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
        const formatPercent = (num, digits = 2) => (num || 0).toLocaleString(undefined, { style: 'percent', minimumFractionDigits: digits, maximumFractionDigits: digits });
        const formatMultiple = (num) => (!num || !isFinite(num)) ? 'N/A' : num.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 }) + 'x';

        // --- Chart Components ---
        // [Chart components: Bar, ChartAxis, YAxisTicks, ScenarioRoiChart, EarlyExitRoiChart, OwnershipChart, ValueChart - remain the same]
        function Bar({ x, y, width, height, colorClass, title }) { if (height <= 0) return null; return ( <rect x={x} y={y} width={width} height={height} className={`${colorClass} fill-current hover:opacity-80 transition-opacity`}><title>{title}</title></rect> ); }
        function ChartAxis({ x1, y1, x2, y2 }) { return <line className="chart-axis" x1={x1} y1={y1} x2={x2} y2={y2} />; }
        function YAxisTicks({ numTicks, maxValue, scale, chartHeight, padding, formatLabel }) { const ticks = Array.from({ length: numTicks }, (_, i) => maxValue * (i / (numTicks - 1))); return ( <g> {ticks.map((val, i) => { const yPos = chartHeight - padding.bottom - (val * scale); if (i === 0 && padding.bottom < 20) return null; return ( <g key={`y-tick-${i}`}> <text className="chart-text" x={padding.left - 8} y={yPos + 4} textAnchor="end">{formatLabel(val)}</text> <line className="chart-axis" x1={padding.left - 4} y1={yPos} x2={padding.left} y2={yPos} /> </g> ); })} </g> ); }
        function ScenarioRoiChart({ data }) { if (!data || data.length === 0) return null; const padding = { top: 20, right: 20, bottom: 40, left: 70 }; const chartWidth = 500; const chartHeight = 250; const barGroupWidth = (chartWidth - padding.left - padding.right) / data.length; const barPadding = 0.3; const barWidth = (barGroupWidth * (1 - barPadding)) / 2; const maxROI = Math.max(...data.flatMap(d => [d.psROI, d.seedROI]), 1); const yScale = (chartHeight - padding.top - padding.bottom) / maxROI; const getBarHeight = (roi) => Math.max(0, (roi || 0) * yScale); const getBarY = (roi) => chartHeight - padding.bottom - getBarHeight(roi); const preSeedColor = "text-[#141E46]"; const seedColor = "text-[#41B06E]"; return ( <div className="mb-6 border bg-white text-gray-800 shadow-md rounded-lg overflow-hidden p-4 sm:p-6"> <h3 className="text-lg font-semibold leading-none tracking-tight text-[#141E46] mb-4 text-center">ROI Multiple by Scenario (on Acquisition)</h3> <div className="flex justify-center mb-3 space-x-4"> <div className="flex items-center"><span className={`w-3 h-3 ${preSeedColor.replace('text-','bg-')} inline-block mr-1.5 rounded-sm`}></span><span className="text-xs text-gray-600">Pre-Seed ROI</span></div> <div className="flex items-center"><span className={`w-3 h-3 ${seedColor.replace('text-','bg-')} inline-block mr-1.5 rounded-sm`}></span><span className="text-xs text-gray-600">Seed ROI</span></div> </div> <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="w-full h-auto" aria-labelledby="scenarioChartTitle"> <title id="scenarioChartTitle">Bar chart showing Pre-Seed and Seed ROI multiples for Conservative, Baseline, and Bullish scenarios.</title> <ChartAxis x1={padding.left} y1={padding.top} x2={padding.left} y2={chartHeight - padding.bottom} /> <YAxisTicks numTicks={5} maxValue={maxROI} scale={yScale} chartHeight={chartHeight} padding={padding} formatLabel={formatMultiple} /> <text className="chart-label" x={20} y={padding.top + (chartHeight - padding.top - padding.bottom) / 2} transform={`rotate(-90, 20, ${padding.top + (chartHeight - padding.top - padding.bottom) / 2})`} textAnchor="middle">ROI Multiple (x)</text> <ChartAxis x1={padding.left} y1={chartHeight - padding.bottom} x2={chartWidth - padding.right} y2={chartHeight - padding.bottom} /> {data.map((d, index) => { const groupX = padding.left + index * barGroupWidth + (barGroupWidth * barPadding / 2); return ( <Fragment key={d.scenario}> <Bar x={groupX} y={getBarY(d.psROI)} width={barWidth} height={getBarHeight(d.psROI)} colorClass={preSeedColor} title={`Pre-Seed (${d.scenario}): ${formatMultiple(d.psROI)}`} /> <Bar x={groupX + barWidth} y={getBarY(d.seedROI)} width={barWidth} height={getBarHeight(d.seedROI)} colorClass={seedColor} title={`Seed (${d.scenario}): ${formatMultiple(d.seedROI)}`} /> <text className="chart-label" x={groupX + barWidth} y={chartHeight - padding.bottom + 15} textAnchor="middle">{d.scenario}</text> </Fragment> ); })} </svg> </div> ); }
        function EarlyExitRoiChart({ data }) { if (!data || data.length === 0) return null; const padding = { top: 20, right: 20, bottom: 40, left: 70 }; const chartWidth = 350; const chartHeight = 250; const barGroupWidth = (chartWidth - padding.left - padding.right) / data.length; const barPadding = 0.2; const barWidth = barGroupWidth * (1 - barPadding); const maxROI = Math.max(...data.map(d => d.roi), 1); const yScale = (chartHeight - padding.top - padding.bottom) / maxROI; const getBarHeight = (roi) => Math.max(0, (roi || 0) * yScale); const getBarY = (roi) => chartHeight - padding.bottom - getBarHeight(roi); const preSeedColor = "text-[#141E46]"; const seedColor = "text-[#41B06E]"; return ( <div className="mb-6 border bg-white text-gray-800 shadow-md rounded-lg overflow-hidden p-4 sm:p-6"> <h3 className="text-lg font-semibold leading-none tracking-tight text-[#141E46] mb-4 text-center">ROI Multiple (Early Exit @ $30M)</h3> <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="w-full h-auto" aria-labelledby="earlyExitChartTitle"> <title id="earlyExitChartTitle">Bar chart showing Pre-Seed and Seed ROI multiples for an early exit based on the Conservative scenario value.</title> <ChartAxis x1={padding.left} y1={padding.top} x2={padding.left} y2={chartHeight - padding.bottom} /> <YAxisTicks numTicks={5} maxValue={maxROI} scale={yScale} chartHeight={chartHeight} padding={padding} formatLabel={formatMultiple} /> <text className="chart-label" x={20} y={padding.top + (chartHeight - padding.top - padding.bottom) / 2} transform={`rotate(-90, 20, ${padding.top + (chartHeight - padding.top - padding.bottom) / 2})`} textAnchor="middle">ROI Multiple (x)</text> <ChartAxis x1={padding.left} y1={chartHeight - padding.bottom} x2={chartWidth - padding.right} y2={chartHeight - padding.bottom} /> {data.map((d, index) => { const barX = padding.left + index * barGroupWidth + (barGroupWidth * barPadding / 2); const barColorClass = d.investor === 'Pre-Seed' ? preSeedColor : seedColor; return ( <Fragment key={d.investor}> <Bar x={barX} y={getBarY(d.roi)} width={barWidth} height={getBarHeight(d.roi)} colorClass={barColorClass} title={`${d.investor}: ${formatMultiple(d.roi)}`} /> <text className="chart-label" x={barX + barWidth / 2} y={chartHeight - padding.bottom + 15} textAnchor="middle">{d.investor}</text> </Fragment> ); })} </svg> </div> ); }
        function OwnershipChart({ data }) { if (!data || data.length === 0) return null; const padding = { top: 20, right: 20, bottom: 40, left: 70 }; const chartWidth = 500; const chartHeight = 250; const barGroupWidth = (chartWidth - padding.left - padding.right) / data.length; const barPadding = 0.3; const barWidth = (barGroupWidth * (1 - barPadding)) / 2; const maxPercent = Math.max(...data.flatMap(d => [d.psPct, d.seedPct]), 0.1); const yScale = (chartHeight - padding.top - padding.bottom) / maxPercent; const getBarHeight = (pct) => Math.max(0, (pct || 0) * yScale); const getBarY = (pct) => chartHeight - padding.bottom - getBarHeight(pct); const preSeedColor = "text-[#141E46]"; const seedColor = "text-[#41B06E]"; return ( <div className="mb-6 border bg-white text-gray-800 shadow-md rounded-lg overflow-hidden p-4 sm:p-6"> <h3 className="text-lg font-semibold leading-none tracking-tight text-[#141E46] mb-4 text-center">Ownership % by Scenario (on Acquisition)</h3> <div className="flex justify-center mb-3 space-x-4"> <div className="flex items-center"><span className={`w-3 h-3 ${preSeedColor.replace('text-','bg-')} inline-block mr-1.5 rounded-sm`}></span><span className="text-xs text-gray-600">Pre-Seed %</span></div> <div className="flex items-center"><span className={`w-3 h-3 ${seedColor.replace('text-','bg-')} inline-block mr-1.5 rounded-sm`}></span><span className="text-xs text-gray-600">Seed %</span></div> </div> <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="w-full h-auto" aria-labelledby="ownershipChartTitle"> <title id="ownershipChartTitle">Bar chart showing Pre-Seed and Seed ownership percentage for Conservative, Baseline, and Bullish scenarios.</title> <ChartAxis x1={padding.left} y1={padding.top} x2={padding.left} y2={chartHeight - padding.bottom} /> <YAxisTicks numTicks={5} maxValue={maxPercent} scale={yScale} chartHeight={chartHeight} padding={padding} formatLabel={(v) => formatPercent(v, 0)} /> <text className="chart-label" x={20} y={padding.top + (chartHeight - padding.top - padding.bottom) / 2} transform={`rotate(-90, 20, ${padding.top + (chartHeight - padding.top - padding.bottom) / 2})`} textAnchor="middle">Ownership (%)</text> <ChartAxis x1={padding.left} y1={chartHeight - padding.bottom} x2={chartWidth - padding.right} y2={chartHeight - padding.bottom} /> {data.map((d, index) => { const groupX = padding.left + index * barGroupWidth + (barGroupWidth * barPadding / 2); return ( <Fragment key={d.scenario}> <Bar x={groupX} y={getBarY(d.psPct)} width={barWidth} height={getBarHeight(d.psPct)} colorClass={preSeedColor} title={`Pre-Seed (${d.scenario}): ${formatPercent(d.psPct)}`} /> <Bar x={groupX + barWidth} y={getBarY(d.seedPct)} width={barWidth} height={getBarHeight(d.seedPct)} colorClass={seedColor} title={`Seed (${d.scenario}): ${formatPercent(d.seedPct)}`} /> <text className="chart-label" x={groupX + barWidth} y={chartHeight - padding.bottom + 15} textAnchor="middle">{d.scenario}</text> </Fragment> ); })} </svg> </div> ); }
        function ValueChart({ data }) { if (!data || data.length === 0) return null; const padding = { top: 20, right: 20, bottom: 40, left: 70 }; const chartWidth = 500; const chartHeight = 250; const barGroupWidth = (chartWidth - padding.left - padding.right) / data.length; const barPadding = 0.3; const barWidth = (barGroupWidth * (1 - barPadding)) / 2; const maxValue = Math.max(...data.flatMap(d => [d.psValue, d.seedValue]), 1000000); const yScale = (chartHeight - padding.top - padding.bottom) / maxValue; const getBarHeight = (value) => Math.max(0, (value || 0) * yScale); const getBarY = (value) => chartHeight - padding.bottom - getBarHeight(value); const preSeedColor = "text-[#141E46]"; const seedColor = "text-[#41B06E]"; return ( <div className="mb-6 border bg-white text-gray-800 shadow-md rounded-lg overflow-hidden p-4 sm:p-6"> <h3 className="text-lg font-semibold leading-none tracking-tight text-[#141E46] mb-4 text-center">Value $ by Scenario (on Acquisition)</h3> <div className="flex justify-center mb-3 space-x-4"> <div className="flex items-center"><span className={`w-3 h-3 ${preSeedColor.replace('text-','bg-')} inline-block mr-1.5 rounded-sm`}></span><span className="text-xs text-gray-600">Pre-Seed Value</span></div> <div className="flex items-center"><span className={`w-3 h-3 ${seedColor.replace('text-','bg-')} inline-block mr-1.5 rounded-sm`}></span><span className="text-xs text-gray-600">Seed Value</span></div> </div> <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="w-full h-auto" aria-labelledby="valueChartTitle"> <title id="valueChartTitle">Bar chart showing Pre-Seed and Seed dollar value for Conservative, Baseline, and Bullish scenarios.</title> <ChartAxis x1={padding.left} y1={padding.top} x2={padding.left} y2={chartHeight - padding.bottom} /> <YAxisTicks numTicks={5} maxValue={maxValue} scale={yScale} chartHeight={chartHeight} padding={padding} formatLabel={formatCurrency} /> <text className="chart-label" x={20} y={padding.top + (chartHeight - padding.top - padding.bottom) / 2} transform={`rotate(-90, 20, ${padding.top + (chartHeight - padding.top - padding.bottom) / 2})`} textAnchor="middle">Value ($)</text> <ChartAxis x1={padding.left} y1={chartHeight - padding.bottom} x2={chartWidth - padding.right} y2={chartHeight - padding.bottom} /> {data.map((d, index) => { const groupX = padding.left + index * barGroupWidth + (barGroupWidth * barPadding / 2); return ( <Fragment key={d.scenario}> <Bar x={groupX} y={getBarY(d.psValue)} width={barWidth} height={getBarHeight(d.psValue)} colorClass={preSeedColor} title={`Pre-Seed (${d.scenario}): ${formatCurrencyNoAbbrev(d.psValue)}`} /> <Bar x={groupX + barWidth} y={getBarY(d.seedValue)} width={barWidth} height={getBarHeight(d.seedValue)} colorClass={seedColor} title={`Seed (${d.scenario}): ${formatCurrencyNoAbbrev(d.seedValue)}`} /> <text className="chart-label" x={groupX + barWidth} y={chartHeight - padding.bottom + 15} textAnchor="middle">{d.scenario}</text> </Fragment> ); })} </svg> </div> ); }

         // --- Function to calculate exit distributions with Liquidation Preference ---
         function calculateExitDistribution(scenarioResult, safeTerms) {
             // [This function remains unchanged]
            const { FinalShares, TotalShares, ExitType, RoundInvestments } = scenarioResult;
            let exitProceeds = 0; if (!scenarioResult) return {};
            if (ExitType === "IPO_and_Acquisition") { exitProceeds = scenarioResult.ExitValuation_Acq; } else { exitProceeds = scenarioResult.ExitValuation; }
            if (TotalShares <= 0 || !FinalShares || !RoundInvestments) return {};
            const preferredClasses = [
                { name: 'Series E', investment: RoundInvestments['Series E'] || 0, shares: FinalShares['Series E'] || 0 }, { name: 'Series D', investment: RoundInvestments['Series D'] || 0, shares: FinalShares['Series D'] || 0 },
                { name: 'Series C', investment: RoundInvestments['Series C'] || 0, shares: FinalShares['Series C'] || 0 }, { name: 'Series B', investment: RoundInvestments['Series B'] || 0, shares: FinalShares['Series B'] || 0 },
                { name: 'Series A', investment: RoundInvestments['Series A'] || 0, shares: FinalShares['Series A'] || 0 }, { name: 'Seed', investment: RoundInvestments['Seed'] || 0, shares: FinalShares['Seed'] || 0 },
                { name: 'Pre-Seed', investment: RoundInvestments['Pre-Seed'] || 0, shares: FinalShares['Pre-Seed'] || 0 } ].filter(p => p.investment > 0 || p.shares > 0);
            const commonClasses = [ { name: 'Founders', shares: FinalShares['Founders'] || 0 }, { name: 'ESOP', shares: FinalShares['ESOP'] || 0 } ];
            const proRataVPS = exitProceeds / TotalShares; let totalPreferenceClaim = 0; let totalParticipatingShares = commonClasses.reduce((sum, c) => sum + c.shares, 0);
            const distribution = {}; const conversionDecisions = {};
            preferredClasses.forEach(p => distribution[p.name] = 0); commonClasses.forEach(c => distribution[c.name] = 0);
            preferredClasses.forEach(pref => { const proRataValue = pref.shares * proRataVPS; if (proRataValue > pref.investment) { conversionDecisions[pref.name] = 'convert'; totalParticipatingShares += pref.shares; } else { conversionDecisions[pref.name] = 'preference'; totalPreferenceClaim += pref.investment; } });
            let remainingProceeds = exitProceeds;
            preferredClasses.forEach(pref => { if (conversionDecisions[pref.name] === 'preference' && remainingProceeds > 0) { const payout = Math.min(remainingProceeds, pref.investment); distribution[pref.name] = payout; remainingProceeds -= payout; } });
            const participatingVPS = totalParticipatingShares > 0 ? remainingProceeds / totalParticipatingShares : 0;
            preferredClasses.forEach(pref => { if (conversionDecisions[pref.name] === 'convert') { distribution[pref.name] = pref.shares * participatingVPS; } });
            commonClasses.forEach(c => { distribution[c.name] = c.shares * participatingVPS; });
            let totalDistributed = Object.values(distribution).reduce((sum, val) => sum + val, 0);
            if (Math.abs(totalDistributed - exitProceeds) > 1) { if (totalDistributed > exitProceeds && totalDistributed > 0) { const factor = exitProceeds / totalDistributed; Object.keys(distribution).forEach(k => distribution[k] *= factor); } }
            return distribution;
        }

        // --- React Component Definition ---
        function App() {
            // State for user inputs - UPDATED DEFAULTS
            const [psInvestmentInput, setPsInvestmentInput] = useState('500000');
            const [psCapInput, setPsCapInput] = useState('10000000'); // Default: 10M
            const [psDiscountInput, setPsDiscountInput] = useState('0');      // Default: 0%
            const [seedInvestmentInput, setSeedInvestmentInput] = useState('1500000');
            const [seedCapInput, setSeedCapInput] = useState('0');      // Default: No Cap
            const [seedDiscountInput, setSeedDiscountInput] = useState('20'); // Default: 20%

            // State for results, loading, and errors
            const [results, setResults] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);

            // Callback function to handle running the simulation
            const handleRunSimulation = useCallback(() => {
                setIsLoading(true); setError(null); setResults(null);
                setTimeout(() => { // Use timeout to allow UI update
                    try {
                        const psInvestment = parseFloat(psInvestmentInput); const psCap = parseFloat(psCapInput); const psDiscount = parseFloat(psDiscountInput);
                        const seedInvestment = parseFloat(seedInvestmentInput); const seedCap = parseFloat(seedCapInput); const seedDiscount = parseFloat(seedDiscountInput);
                        if (isNaN(psInvestment) || psInvestment <= 0 || isNaN(psCap) || psCap < 0 || isNaN(psDiscount) || psDiscount < 0 || psDiscount > 100 ||
                            isNaN(seedInvestment) || seedInvestment <= 0 || isNaN(seedCap) || seedCap < 0 || isNaN(seedDiscount) || seedDiscount < 0 || seedDiscount > 100) {
                            throw new Error("Invalid input. Please enter valid numbers (Investment > 0, Cap >= 0, Discount 0-100).");
                        }
                        const safeTerms = {
                            'Pre-Seed': { investment: psInvestment, cap: psCap > 0 ? psCap : null, discount: psDiscount },
                            'Seed': { investment: seedInvestment, cap: seedCap > 0 ? seedCap : null, discount: seedDiscount }
                        };
                        const initial_shares = { 'Founders': FOUNDER_SHARES, 'ESOP': INITIAL_ESOP_SHARES };
                        const conservativeResults = simulateScenario("Conservative", { ...initial_shares }, safeTerms);
                        const baselineResults = simulateScenario("Baseline", { ...initial_shares }, safeTerms);
                        const bullishResults = simulateScenario("Bullish", { ...initial_shares }, safeTerms);

                        // Calculate final distributions including liquidation preference
                        const conservativeDistribution = calculateExitDistribution(conservativeResults, safeTerms);
                        const baselineDistribution = calculateExitDistribution(baselineResults, safeTerms);
                        const bullishDistribution = calculateExitDistribution(bullishResults, safeTerms);

                        setResults({
                            conservative: { ...conservativeResults, distribution: conservativeDistribution },
                            baseline: { ...baselineResults, distribution: baselineDistribution },
                            bullish: { ...bullishResults, distribution: bullishDistribution },
                            safeTerms
                         });
                    } catch (err) { console.error("Simulation Error:", err); setError(err.message || "An error occurred during simulation.");
                    } finally { setIsLoading(false); }
                }, 10);
            }, [psInvestmentInput, psCapInput, psDiscountInput, seedInvestmentInput, seedCapInput, seedDiscountInput]); // Dependencies


            // Helper function to render results for a single scenario card
            const renderScenarioCard = (scenarioResult) => {
                 // [This function remains largely unchanged, but uses 'distribution' for exit values]
                 if (!scenarioResult) return null;
                 const { Scenario, TotalShares, FinalShares, ExitType, Rounds, RoundInvestments, distribution, ExitValuation, ValuePerShare, ExitValuation_IPO, ValuePerShare_IPO, ExitValuation_Acq } = scenarioResult;
                 const safeTermsUsed = results?.safeTerms;
                 const totalRaisedPriced = (Rounds || []).reduce((sum, round) => sum + round.investment, 0);
                 const founderExitValueAcq = distribution?.['Founders'] || 0; const psExitValueAcq = distribution?.['Pre-Seed'] || 0; const seedExitValueAcq = distribution?.['Seed'] || 0;
                 const founderIPOValue = (FinalShares['Founders'] || 0) * (ValuePerShare_IPO || 0); const psIPOValue = (FinalShares['Pre-Seed'] || 0) * (ValuePerShare_IPO || 0); const seedIPOValue = (FinalShares['Seed'] || 0) * (ValuePerShare_IPO || 0);
                 const displayExitValuation = ExitType === "IPO_and_Acquisition" ? ExitValuation_Acq : ExitValuation;
                 const founderDisplayValue = founderExitValueAcq; const psDisplayValue = psExitValueAcq; const seedDisplayValue = seedExitValueAcq;

                 return ( <div className="mb-6 border bg-white text-gray-800 shadow-md rounded-lg overflow-hidden"> <div className="flex flex-col space-y-1.5 p-4 sm:p-6 bg-gray-50 border-b"> <h3 className="text-xl font-semibold leading-none tracking-tight text-[#141E46]">{Scenario} Scenario Results</h3> </div> <div className="p-4 sm:p-6"> <h4 className="font-semibold text-lg mb-3 text-gray-700">Ownership Breakdown (at Exit):</h4> <div className="overflow-x-auto"> <table className="w-full caption-bottom text-sm"> <thead className="[&_tr]:border-b"> <tr className="border-b"> <th className="h-12 px-4 text-left align-middle font-medium text-gray-500">Stakeholder</th> <th className="h-12 px-4 text-right align-middle font-medium text-gray-500">Shares</th> <th className="h-12 px-4 text-right align-middle font-medium text-gray-500">Percentage</th> </tr> </thead> <tbody> {Object.entries(FinalShares).sort(([, countA], [, countB]) => countB - countA).map(([owner, count]) => ( <tr key={owner} className="border-b hover:bg-gray-50/50"> <td className="p-4 align-middle font-medium">{owner}</td> <td className="p-4 align-middle text-right">{formatNumber(count)}</td> <td className="p-4 align-middle text-right">{formatPercent(TotalShares > 0 ? count / TotalShares : 0)}</td> </tr> ))} <tr className="font-bold border-t"> <td className="p-4 align-middle">Total</td> <td className="p-4 align-middle text-right">{formatNumber(TotalShares)}</td> <td className="p-4 align-middle text-right">100.00%</td> </tr> </tbody> </table> </div> <h4 className="font-semibold text-lg mt-6 mb-3 text-gray-700">Exit Values (Calculated with 1x Non-Participating Preference):</h4> {ExitType === "IPO_and_Acquisition" ? ( <div className="space-y-4"> <div> <p className="font-medium"><strong>IPO @ {formatCurrency(ExitValuation_IPO)}</strong> (~{formatCurrencyNoAbbrev(ValuePerShare_IPO)}/share - Pro-rata):</p> <ul className="list-disc list-inside ml-4 text-sm space-y-1"> <li>Founders: {formatCurrency(founderIPOValue)}</li> <li>Pre-Seed: {formatCurrency(psIPOValue)}</li> <li>Seed: {formatCurrency(seedIPOValue)}</li> </ul> </div> <div> <p className="font-medium"><strong>Acquisition @ {formatCurrency(ExitValuation_Acq)}</strong> (with Preference):</p> <ul className="list-disc list-inside ml-4 text-sm space-y-1"> <li>Founders: {formatCurrency(founderExitValueAcq)}</li> <li>Pre-Seed: {formatCurrency(psExitValueAcq)} ({formatMultiple(safeTermsUsed ? psExitValueAcq / safeTermsUsed['Pre-Seed'].investment : 0)} return)</li> <li>Seed: {formatCurrency(seedExitValueAcq)} ({formatMultiple(safeTermsUsed ? seedExitValueAcq / safeTermsUsed['Seed'].investment : 0)} return)</li> </ul> </div> </div> ) : ( <div> <p className="font-medium"><strong>{ExitType} @ {formatCurrency(ExitValuation)}</strong> (with Preference):</p> <ul className="list-disc list-inside ml-4 text-sm space-y-1"> <li>Founders: {formatCurrency(founderDisplayValue)}</li> <li>Pre-Seed: {formatCurrency(psDisplayValue)} ({formatMultiple(safeTermsUsed ? psDisplayValue / safeTermsUsed['Pre-Seed'].investment : 0)} return)</li> <li>Seed: {formatCurrency(seedDisplayValue)} ({formatMultiple(safeTermsUsed ? seedDisplayValue / safeTermsUsed['Seed'].investment : 0)} return)</li> </ul> </div> )} <div className="mt-6 pt-4 border-t border-gray-200"> <h5 className="font-semibold text-sm mb-2 text-gray-600">Key Assumptions for Scenario:</h5> <ul className="list-disc list-inside ml-4 text-xs text-gray-500 space-y-1"> {Rounds && Rounds.length > 0 ? ( <> {Rounds.map(round => ( <li key={round.name}> {round.name}: Raise {formatCurrency(round.investment)} @ {formatCurrency(round.pre_money)} Pre-Money </li> ))} <li>Total Priced Rounds Raised: {formatCurrency(totalRaisedPriced)}</li> </> ) : ( <li>Early Exit @ {formatCurrency(ExitValuation)} (Acts as trigger valuation, no priced rounds occurred)</li> )} <li>ESOP Target: {formatPercent(ESOP_TARGET_PCT, 0)} (Simplified calculation)</li> <li>Liquidation Preference: 1x Non-Participating (applied on Acquisition)</li> </ul> </div> </div> </div> ); };

            // --- Main Component Render ---
            // Calculate chart data conditionally ONLY when results are available
            let scenarioRoiChartData = [];
            let earlyExitRoiChartData = [];
            let ownershipChartData = [];
            let valueChartData = [];

            if(results && !isLoading) {
                // Calculate Scenario ROI Data (based on final distribution)
                const scenariosROI = ['Conservative', 'Baseline', 'Bullish'];
                scenarioRoiChartData = scenariosROI.map(scenarioName => {
                    const scenarioResult = results[scenarioName.toLowerCase()];
                    const safeTermsUsed = results.safeTerms; let psROI = 0, seedROI = 0;
                    if (scenarioResult && safeTermsUsed && scenarioResult.distribution) {
                        const psExitValue = scenarioResult.distribution['Pre-Seed'] || 0; const seedExitValue = scenarioResult.distribution['Seed'] || 0;
                        const psInvestment = safeTermsUsed['Pre-Seed']?.investment; const seedInvestment = safeTermsUsed['Seed']?.investment;
                        psROI = (psInvestment > 0) ? psExitValue / psInvestment : 0; seedROI = (seedInvestment > 0) ? seedExitValue / seedInvestment : 0;
                    } return { scenario: scenarioName, psROI: isFinite(psROI) ? psROI : 0, seedROI: isFinite(seedROI) ? seedROI : 0 };
                });
                // Calculate Early Exit ROI Data (based on conservative distribution)
                 const conservativeResult = results.conservative; const safeTermsUsed = results.safeTerms;
                 if (conservativeResult && safeTermsUsed && conservativeResult.distribution) {
                     const psExitValue = conservativeResult.distribution['Pre-Seed'] || 0; const seedExitValue = conservativeResult.distribution['Seed'] || 0;
                     const psInvestment = safeTermsUsed['Pre-Seed']?.investment; const seedInvestment = safeTermsUsed['Seed']?.investment;
                     const psROI = (psInvestment > 0) ? psExitValue / psInvestment : 0; const seedROI = (seedInvestment > 0) ? seedExitValue / seedInvestment : 0;
                     earlyExitRoiChartData = [ { investor: 'Pre-Seed', roi: isFinite(psROI) ? psROI : 0 }, { investor: 'Seed', roi: isFinite(seedROI) ? seedROI : 0 } ];
                 }
                // Calculate Ownership Data (remains based on shares)
                const scenariosOwn = ['Conservative', 'Baseline', 'Bullish'];
                ownershipChartData = scenariosOwn.map(scenarioName => {
                     const scenarioResult = results[scenarioName.toLowerCase()]; let psPct = 0, seedPct = 0;
                     if (scenarioResult && scenarioResult.TotalShares > 0) { psPct = (scenarioResult.FinalShares['Pre-Seed'] || 0) / scenarioResult.TotalShares; seedPct = (scenarioResult.FinalShares['Seed'] || 0) / scenarioResult.TotalShares; }
                     return { scenario: scenarioName, psPct, seedPct };
                 });
                // Calculate Value Data (based on final distribution)
                const scenariosVal = ['Conservative', 'Baseline', 'Bullish'];
                valueChartData = scenariosVal.map(scenarioName => {
                     const scenarioResult = results[scenarioName.toLowerCase()]; let psValue = 0, seedValue = 0;
                     if (scenarioResult && scenarioResult.distribution) { psValue = scenarioResult.distribution['Pre-Seed'] || 0; seedValue = scenarioResult.distribution['Seed'] || 0; }
                     return { scenario: scenarioName, psValue: isFinite(psValue) ? psValue : 0, seedValue: isFinite(seedValue) ? seedValue : 0 };
                 });
            }

            return (
                <div className="container mx-auto p-4 sm:p-6 lg:p-8 max-w-4xl">
                    <h1 className="text-3xl font-bold mb-6 text-center text-[#141E46]">VC Funding Scenario Simulator</h1>
                    {/* Input Card */}
                    <div className="mb-8 border bg-white text-gray-800 shadow-lg rounded-lg"> <div className="flex flex-col space-y-1.5 p-6 bg-gray-50 border-b rounded-t-lg"> <h3 className="text-xl font-semibold leading-none tracking-tight text-[#141E46]">SAFE Note Inputs</h3> </div> <div className="p-6"> <div className="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6"> <div className="space-y-4"> <h3 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-3">Pre-Seed Round</h3> <div> <label htmlFor="psInvestment" className="text-sm font-medium text-gray-700 mb-1 block">Investment Amount ($)</label> <input id="psInvestment" type="number" value={psInvestmentInput} onChange={(e) => setPsInvestmentInput(e.target.value)} placeholder="e.g., 500000" min="1" className="flex h-10 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#141E46] focus:border-transparent disabled:cursor-not-allowed disabled:opacity-50"/> </div> <div> <label htmlFor="psCap" className="text-sm font-medium text-gray-700 mb-1 block">Valuation Cap ($) <span className="text-xs text-gray-500">(0 for No Cap)</span></label> <input id="psCap" type="number" value={psCapInput} onChange={(e) => setPsCapInput(e.target.value)} placeholder="e.g., 8000000" min="0" className="flex h-10 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#141E46] focus:border-transparent disabled:cursor-not-allowed disabled:opacity-50"/> </div> <div> <label htmlFor="psDiscount" className="text-sm font-medium text-gray-700 mb-1 block">Discount (%)</label> <input id="psDiscount" type="number" value={psDiscountInput} onChange={(e) => setPsDiscountInput(e.target.value)} placeholder="e.g., 20" min="0" max="100" step="0.1" className="flex h-10 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#141E46] focus:border-transparent disabled:cursor-not-allowed disabled:opacity-50"/> </div> </div> <div className="space-y-4"> <h3 className="text-lg font-semibold text-gray-700 border-b pb-2 mb-3">Seed Round</h3> <div> <label htmlFor="seedInvestment" className="text-sm font-medium text-gray-700 mb-1 block">Investment Amount ($)</label> <input id="seedInvestment" type="number" value={seedInvestmentInput} onChange={(e) => setSeedInvestmentInput(e.target.value)} placeholder="e.g., 1500000" min="1" className="flex h-10 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#141E46] focus:border-transparent disabled:cursor-not-allowed disabled:opacity-50"/> </div> <div> <label htmlFor="seedCap" className="text-sm font-medium text-gray-700 mb-1 block">Valuation Cap ($) <span className="text-xs text-gray-500">(0 for No Cap)</span></label> <input id="seedCap" type="number" value={seedCapInput} onChange={(e) => setSeedCapInput(e.target.value)} placeholder="e.g., 12000000" min="0" className="flex h-10 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#141E46] focus:border-transparent disabled:cursor-not-allowed disabled:opacity-50"/> </div> <div> <label htmlFor="seedDiscount" className="text-sm font-medium text-gray-700 mb-1 block">Discount (%)</label> <input id="seedDiscount" type="number" value={seedDiscountInput} onChange={(e) => setSeedDiscountInput(e.target.value)} placeholder="e.g., 20" min="0" max="100" step="0.1" className="flex h-10 w-full rounded-md border border-gray-300 bg-transparent px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#141E46] focus:border-transparent disabled:cursor-not-allowed disabled:opacity-50"/> </div> </div> <div className="md:col-span-2 mt-6 flex justify-center"> <button onClick={handleRunSimulation} disabled={isLoading} className="inline-flex items-center justify-center px-6 py-2 bg-[#141E46] text-[#FFF5E0] font-semibold rounded-md shadow-sm hover:bg-opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#141E46] disabled:opacity-50 transition duration-150 ease-in-out"> {isLoading ? 'Simulating...' : 'Run Simulation'} {isLoading && <span className="spinner"></span>} </button> </div> </div> {error && <p className="text-[#F4291B] mt-4 text-center">{error}</p>} </div> </div>

                    {/* Results Section */}
                    {results && !isLoading && (
                        <div className="mt-10">
                            <h2 className="text-2xl font-semibold mb-5 text-center text-[#141E46]">Simulation Outputs</h2>
                            {/* Render result cards first, passing round data */}
                            {renderScenarioCard(results.conservative)}
                            {renderScenarioCard(results.baseline)}
                            {renderScenarioCard(results.bullish)}

                            {/* Chart Section - 2x2 Grid */}
                             <div className="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                                 {/* Row 1 */}
                                 <ScenarioRoiChart data={scenarioRoiChartData} />
                                 <EarlyExitRoiChart data={earlyExitRoiChartData} />
                                 {/* Row 2 */}
                                 <OwnershipChart data={ownershipChartData} />
                                 <ValueChart data={valueChartData} />
                             </div>

                            {/* Disclaimer */}
                            <p className="text-xxs text-gray-500 mt-10 text-center"> {/* Lighter gray */}
                                Note: These are simplified models ignoring certain complex terms. Exit values calculated assuming 1x Non-Participating Liquidation Preference for preferred investors on Acquisition. ESOP and SAFE conversion calculations use approximations.
                            </p>
                        </div>
                    )}
                </div>
            );
        }

        // --- Mount React App ---
    </script>

    <script type="text/babel">
        try {
            ReactDOM.render( <App />, document.getElementById('root') );
        } catch (error) {
            console.error("Error rendering full React app:", error);
            const rootDiv = document.getElementById('root');
            if (rootDiv) { rootDiv.innerHTML = '<div style="padding: 20px; border: 1px solid red; background-color: #fee; color: #a00; font-family: sans-serif;"><h2>Error Rendering Application</h2><p>Could not render the React component. Check browser console (F12) for errors.</p><pre style="white-space: pre-wrap; word-wrap: break-word;">Error: ' + error.message + '</pre></div>'; }
        }
    </script>

</body>
</html>

